With thanks to

@ripienaar for the original version of the code
@mozilla-services for allowing me the time to do this
@richardc for testing and fixtures discussions
